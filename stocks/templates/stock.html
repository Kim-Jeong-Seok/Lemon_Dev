{% extends 'base.html' %}
{% load static %}
{% block title %}레몬::주식{% endblock title %}
{% block container %}
{% load humanize %}
{% load mathfilters %}
<style>
    #footer_sotck{
        background: url(..media/stock_active.png);
    }
    .stock{
    padding:20px;
    }
    .stocks{
    padding-bottom:10px;
    border-bottom: 1px solid #ebebeb
    }
     .stock_name{
    display:inline-block;
    }
    .stock_current_price{
    float:right;
    }
    .buy_price{
     display:inline-block;
     }
     .refresh{
     float:right;
     color:#31bc8a;
     }
</style>

{% load mytag %}
<div class="stock">
<div>
    <a class="refresh" onclick="fn_koscom_history()"><i class="fa fa-refresh" aria-hidden="true"></i></a>
    <strong>{{user.username}}</strong>님의<br>
   <strong>보유 주식</strong>
</div>
    <div style="padding-top:20px;">
{% for ele in stock_data %}
    <div class="stocks">
    <div class="stock_name">{{ele.0}}&nbsp;&nbsp;</div>
    <div class="stock_current_price">{{ele.2|intcomma}}원</div>
        <div>
    <div class="buy_price">구매가격 {{ele.1|intcomma }}원</div>
        <div style="float:right;">{{ele.2|yields:ele.1|rounds:2}}%</div>
    </div></div>
{% empty %}
    <span>구매한 주식이 없습니다</span>
{% endfor %}
</div></div>



<script>
    var csrftoken = getCookie('csrftoken');
    function getCookie(cname) {
        var name = cname + "=";
            decodedCookie = decodeURIComponent(document.cookie);
            ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
            var c = ca[i].trim();
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    function fn_koscom_history() {
        var data = {
                'marketcode': 'kospi',
                'issuecode': '005930',
                'trnsmCycleTpCd': 'D',
                'inqStrtDd': '20170101',
                'inqEndDd': '20170331',
                'reqCnt': '20'
            }
            headers = new Headers();
        headers.append('Content-Type', 'application/json')
        headers.append('X-CSRFToken', csrftoken)
        fetch('/get_history', {
            method: "POST",
            headers: headers,
            body: JSON.stringify(data)
        })
        .then(res => {
            if(res.status === 200) return res.json();
            else console.log(res.statusText);
        })
        .then(json => {
            console.log(json.result);
        })
        .catch(err => {
            console.log(err)
        })
    }
</script>
{% endblock %}