{% extends 'base.html' %}
{% load static %}
{% block title %}레몬::추천{% endblock title %}
{% block container %}
{% load humanize %}

<style>
   /* FOOTER에서 사용하는 CSS */
   .bottom-nav-calendar{
    color: #FFD859 !important;
  }

  .bottom-nav-calendar a{
    color: #FFD859 !important;
  }

  .bottom-nav-search-stock a,.bottom-nav-home a,
  .bottom-nav-stock a,.bottom-nav-addlist a,
  .bottom-nav-myinfo a{
    font-family: 'Noto Sans KR', sans-serif;
    font-weight: 500;
    font-size: 0.8rem;
    color: #D1D6DA !important;
  }
  ul{
    list-style: none;
    margin:0;
    padding: 0;
  }
  .pagenation{
    background-color: #f5f5f5;
    z-index: 10;
    padding:0;
    bottom: 70px;
    left: 28px;
    position: fixed;
    vertical-align: middle;
    text-align: center;
    width: 90%;
    height: 30px;
    border-radius: 20px;
    margin: 0 auto;
  }
  .pagenation li{
    padding-top: 2px;
    font-weight: 500;
    border-radius: 20px;
    width : 24%;
    height: 30px;
    display:inline-block;
  }

  #pagenation_summary{
    background-color: #4C8AE5;
  }
  #pagenation_summary a{
    color: #fff;
  }
  #pagenation_recom a, #pagenation_list a, #pagenation_calendar a{
    color: #adadad;
  }
</style>

<!-- pagenatino -->
<div class="pagenation">
  <ul>
    <li id="pagenation_recom"><a href="{% url 'calendars:recom' %}">추천</a></li>
    <li id="pagenation_summary"><a href="{% url 'calendars:summary' %}">요약</a></li>
    <li id="pagenation_list"><a href="{% url 'calendars:listview' %}">내역</a></li>
    <li id="pagenation_calendar"><a href="{% url 'calendars:calendar' %}">TOP 5</a></li>
  </ul>
</div>

<!-- Modal -->
<div id="calendarModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
          <h3 id="modalTitle" class="modal-title"></h3>
          <button type="button" onclick="close_btn()" id="close_btn" class="btn btn-default" data-dismiss="modal">X</button>
      </div>
      <div id="modalBody" class="modal-body">
      </div>
      <div class="modal-footer">
        <button type="button" onclick="location.href='add_calendar'" id="add_event" class="addList-btn" data-dismiss="modal">내역추가</button>
      </div>
    </div>
  </div>
</div>
  <script>
    function close_btn() {
      $('#calendarModal').modal('hide');
    }
  </script>
<!-- Modal관련끝 -->

<div class="swiper-slide" data-name="요약" data-hash="summary">
  <div class="money-info-wrap">
    <div class="money-info-container">
      <a class="money-info-title">
        <strong>{{user.uid}}</strong>님의 <strong>{{month}}월</strong> 누적금액
      </a><br>

      <div class="amountMoney">
        <a id="amount-money1" style="display: none;">{{user.invest|default_if_none:'0'}}</a>
        <div class="money-wrap"><a id="amount-money" class="amount-money"></a><a class="amount-won">won</a></div>
      </div>

      <script>
        //DB에 저장된 usermoney에 천단위 ,(콤마) 찍어주는 스크립트
        //1. display:none 상태인 amount-money1의 값을 가져온다.
        var innerText = document.getElementById('amount-money1').innerText;
        //2. 긁어온 값에 천단위 , 찍어주고 cn1 변수에 저장
        const cn1 = innerText.toString()
        .replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",");

        //3. cn1 변수에 저장된 값을 amount-money 값에 띄워줌
        const cn1element = document.getElementById('amount-money');
        cn1element.innerHTML = cn1;
      </script>

      <div style="text-align:initial; padding-left:1rem;">
        <div style="margin-top:10px; margin-bottom:10px;">
          <a style="color:#FFF; font-weight: bold;">지출</a> <a style="margin-left: 10px; margin-right:10px; font-weight:400; color:#FFF;">{{Expenditure.amount__sum|default_if_none:'0'|intcomma}} won</a>
        </div>

        <div style="margin-bottom:20px; width:50%; position:relative; padding-bottom:2px; border-bottom:1px solid #fff;">
          <a style="color:#FFF; font-weight: bold;">수입</a> <a style="margin-left: 10px; font-weight:400; color:#FFF;">{{Income.amount__sum|default_if_none:'0'|intcomma}} won</a>
        </div>

      </div>
    </div><!--money-info-container 끝-->
  </div><!--money-info-wrap 끝-->

  <!--- 달력 SWIPER div영역 시작--->
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          var calendarEl = document.getElementById('calendar');

          var date = new Date();
          var d = date.getDate();
          var m = date.getMonth() + 1;
          var y = date.getFullYear();
          var date1 = (y+'-'+m+'-'+d);
          var date2 = (y+'-'+m);
          console.log('Today is ' + date1);


        var calendar = new FullCalendar.Calendar(calendarEl, {
          selectable: false,
          selectOverlap:false,
          editable: false,
          droppable:false,
          themeSystem: 'standard',
          dragScroll:false,
          headerToolbar: {
            left: '',
            center: 'prev title next',
            right: ''
          },
          titleFormat: function (date) {
            // YYYY년 MM월
            return `${date.date.year}년 ${date.date.month + 1}월`;
          },
          dayHeaderContent: function (date) {
            let weekList = ["일", "월", "화", "수", "목", "금", "토"];
            return weekList[date.dow];
          },
          height: 450,
          //locale: 'en',
          events: [
          {% for i in spend_day_sum2 %}
          {
            title: "-{{i.amount|intcomma}}",
            start: "{{i.spend_date | date:'Y-m-d'}}",
            textColor: 'Red',
            color:'transparent',
            allday: 1,
          },
          {% endfor %}
          {% for i in income_day_sum2 %}
          {
            title: "+{{i.amount|intcomma}}",
            start: "{{i.income_date | date:'Y-m-d'}}",
            textColor: 'Blue',
            color:'transparent',
            allday: 1,
          },
          {% endfor %}
        ],
        eventClick: function(info) {
          console.log(info.event);
          click_date = info.event.startStr; // 날짜
          title_date = moment(click_date).format('DD일');
          //click_title = event.dayEl.innerText;
          console.log(click_date);
          document.getElementById('click_date').value = click_date;
          $.ajax({
            type: "POST",
            url: "{% url 'calendars:ajax_pushdate' %}",
            data: {
              clikDate: $('#click_date').val(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
              dataType: "json",
            },
            success: function(data){
              
              msg_value = data.msg1;
              const reset = document.getElementById('modalBody');
              const element = document.getElementById('modalBody');
              reset.innerHTML = '';
              $.each (msg_value, function (index, el) {
                console.log('element', index, el);
                element.innerHTML += '<div class="modal-body-text">'+el.kind+
                                    el.amount +'원</div>';
              });
            },
            fail: function(data) {
              console.log('ajax send error!');
              alert('해당날짜의 내역을 불러오는 과정에서 오류가 발생했습니다');
            },
          });
          $('#calendarModal').modal('show');
          $('#modalTitle').text(title_date);
          },
        });
        calendar.render();
      });
      </script>
      <div class="swiper-slide" id="swiper-cal" data-name="달력" data-hash="calendar2">
        <div class="cal-container">
          <div id='calendar'></div>
        </div>
        <input type="hidden" value="" id="click_date">





</div><!--- 요약 SWIPER div영역 끝 --->
<script>
  var myElement = document.getElementById('container');

  // create a simple instance
  // by default, it only adds horizontal recognizers
  var mc = new Hammer(myElement);

  // listen to events...
  mc.on("swipeleft", function(ev) {
      window.location.href="/listview";
  });

  mc.on("swiperight", function(ev) {
      window.location.href="/recom";
});
</script>
<link rel = "stylesheet" href="{% static 'css/main.css' %}">
<link rel = "stylesheet" href="{% static 'css/style.css' %}">
<script src="{% static 'js/main.js' %}"></script>
{% endblock container %}
